<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Doggo</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>


    <!-- Bootstrap core CSS -->
    <link href="static/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>

    <div class="container">
      <form class="form-signin" role="form">
        <h2 class="form-signin-heading">Do </h2>
        <input type="text" name="search" class="form-control"required autofocus>
        <button class="btn btn-lg btn-primary btn-block" type="button">Do</button>
      </form>
      <form id="uploadForm" name="uploadForm">
        <input type="file" id="file" name="file"><br /><br />
        <input type="submit" value="Upload">
      </form>
      <br><br>
      <div class="progress">
        <div id="progressBar" name="progressBar" class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100">
          Calculating...
        </div>
      </div>
    </div>


    <div>
      <p>RESULTS:</p>
      <div name="output" id="output"></div>
    </div>

  </body>
</html>

	<script>
  function progressBar() {
    $('#progressBar').show();
    var elem = document.getElementById("progressBar");
    var width = 1;
    var id = setInterval(frame, 75);
    function frame() {
      if (width >= 100) {
        clearInterval(id);
      } else {
        width++;
        elem.style.width = width + '%';
      }
    }
  }
  function classify() {
    var input = $('#search').val();
    $.ajax({
        url: '/api/classify',
        data: $('form').serialize(),
        type: 'POST',
        success: function(res) {
          $('#progressBar').hide();
          $('#output').html("");
          for (var i=0; i <= res.results.length; i++) {
            $('#output').append(res.results[i].name + "  ");
            $('#output').append(res.results[i].score);
            $('#output').append("<br><br>");
          }
          return false;
        },
        error: function(error) {
            alert(error);
            return false;
        }
    });
  }

  $(function() {
    $('#progressBar').hide();
    $('button').click(function() {
      progressBar();

      classify();
		});

    $('#uploadForm').submit(function (e) {
      progressBar();

      // var data;
      // data = new FormData();
      // data.append('file', $('#file')[0].files[0]);

      var form_data = new FormData($('#uploadForm')[0]);
      $.ajax({
          type: 'POST',
          url: '/upload',
          data: form_data,
          contentType: false,
          cache: false,
          processData: false,

      // $.ajax({
      //     url: '/upload',
      //     data: data,
      //     processData: false,
      //     type: 'POST',
      //     contentType: 'multipart/form-data',
      //     beforeSend: function (x) {
      //         if (x && x.overrideMimeType) {
      //             x.overrideMimeType("multipart/form-data");
      //         }
      //     },
      //     mimeType: 'multipart/form-data',    //Property added in 1.5.1
          success: function (res) {
            $('#progressBar').hide();
            $('#output').html("");
            for (var i=0; i <= res.results.length; i++) {
              $('#output').append(res.results[i].name + "  ");
              $('#output').append(res.results[i].score);
              $('#output').append("<br><br>");
            }
            return false;
          },
          error: function(error) {
              alert(error);
              return false;
          }
      });
      e.preventDefault();
    });
  });
	</script>
